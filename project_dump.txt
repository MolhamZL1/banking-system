
===== ./.env =====
DATABASE_URL="postgresql://postgres:1234@localhost:5432/advanced_banking?schema=public"
PORT=3000
NODE_ENV=development

===== ./.gitignore =====
node_modules
# Keep environment variables out of version control
.env

/src/generated/prisma

===== ./package-lock.json =====
{
  "name": "advanced-banking-system",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "advanced-banking-system",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "@prisma/client": "^6.15.0",
        "cors": "^2.8.5",
        "dotenv": "^17.2.3",
        "express": "^5.2.1",
        "helmet": "^8.1.0",
        "morgan": "^1.10.1",
        "zod": "^4.1.13"
      },
      "devDependencies": {
        "@types/cors": "^2.8.19",
        "@types/express": "^5.0.6",
        "@types/morgan": "^1.9.10",
        "@types/node": "^24.10.2",
        "prisma": "^6.15.0",
        "ts-node-dev": "^2.0.0",
        "typescript": "^5.9.3"
      }
    },
    "node_modules/@cspotcode/source-map-support": {
      "version": "0.8.1",
      "resolved": "https://registry.npmjs.org/@cspotcode/source-map-support/-/source-map-support-0.8.1.tgz",
      "integrity": "sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/trace-mapping": "0.3.9"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.9.tgz",
      "integrity": "sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.0.3",
        "@jridgewell/sourcemap-codec": "^1.4.10"
      }
    },
    "node_modules/@prisma/client": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/client/-/client-6.15.0.tgz",
      "integrity": "sha512-wR2LXUbOH4cL/WToatI/Y2c7uzni76oNFND7+23ypLllBmIS8e3ZHhO+nud9iXSXKFt1SoM3fTZvHawg63emZw==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "peerDependencies": {
        "prisma": "*",
        "typescript": ">=5.1.0"
      },
      "peerDependenciesMeta": {
        "prisma": {
          "optional": true
        },
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/@prisma/config": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/config/-/config-6.15.0.tgz",
      "integrity": "sha512-KMEoec9b2u6zX0EbSEx/dRpx1oNLjqJEBZYyK0S3TTIbZ7GEGoVyGyFRk4C72+A38cuPLbfQGQvgOD+gBErKlA==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "c12": "3.1.0",
        "deepmerge-ts": "7.1.5",
        "effect": "3.16.12",
        "empathic": "2.0.0"
      }
    },
    "node_modules/@prisma/debug": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/debug/-/debug-6.15.0.tgz",
      "integrity": "sha512-y7cSeLuQmyt+A3hstAs6tsuAiVXSnw9T55ra77z0nbNkA8Lcq9rNcQg6PI00by/+WnE/aMRJ/W7sZWn2cgIy1g==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/engines": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/engines/-/engines-6.15.0.tgz",
      "integrity": "sha512-opITiR5ddFJ1N2iqa7mkRlohCZqVSsHhRcc29QXeldMljOf4FSellLT0J5goVb64EzRTKcIDeIsJBgmilNcKxA==",
      "devOptional": true,
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0",
        "@prisma/engines-version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
        "@prisma/fetch-engine": "6.15.0",
        "@prisma/get-platform": "6.15.0"
      }
    },
    "node_modules/@prisma/engines-version": {
      "version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
      "resolved": "https://registry.npmjs.org/@prisma/engines-version/-/engines-version-6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb.tgz",
      "integrity": "sha512-a/46aK5j6L3ePwilZYEgYDPrhBQ/n4gYjLxT5YncUTJJNRnTCVjPF86QdzUOLRdYjCLfhtZp9aum90W0J+trrg==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/fetch-engine": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/fetch-engine/-/fetch-engine-6.15.0.tgz",
      "integrity": "sha512-xcT5f6b+OWBq6vTUnRCc7qL+Im570CtwvgSj+0MTSGA1o9UDSKZ/WANvwtiRXdbYWECpyC3CukoG3A04VTAPHw==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0",
        "@prisma/engines-version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
        "@prisma/get-platform": "6.15.0"
      }
    },
    "node_modules/@prisma/get-platform": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/get-platform/-/get-platform-6.15.0.tgz",
      "integrity": "sha512-Jbb+Xbxyp05NSR1x2epabetHiXvpO8tdN2YNoWoA/ZsbYyxxu/CO/ROBauIFuMXs3Ti+W7N7SJtWsHGaWte9Rg==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0"
      }
    },
    "node_modules/@standard-schema/spec": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@standard-schema/spec/-/spec-1.0.0.tgz",
      "integrity": "sha512-m2bOd0f2RT9k8QJx1JN85cZYyH1RqFBdlwtkSlf4tBDYLCiiZnv1fIIwacK6cqwXavOydf0NPToMQgpKq+dVlA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node10": {
      "version": "1.0.12",
      "resolved": "https://registry.npmjs.org/@tsconfig/node10/-/node10-1.0.12.tgz",
      "integrity": "sha512-UCYBaeFvM11aU2y3YPZ//O5Rhj+xKyzy7mvcIoAjASbigy8mHMryP5cK7dgjlz2hWxh1g5pLw084E0a/wlUSFQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node12": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/@tsconfig/node12/-/node12-1.0.11.tgz",
      "integrity": "sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node14": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/@tsconfig/node14/-/node14-1.0.3.tgz",
      "integrity": "sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node16": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/@tsconfig/node16/-/node16-1.0.4.tgz",
      "integrity": "sha512-vxhUy4J8lyeyinH7Azl1pdd43GJhZH/tP2weN8TntQblOY+A0XbT8DJk1/oCPuOOyg/Ja757rG0CgHcWC8OfMA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/body-parser": {
      "version": "1.19.6",
      "resolved": "https://registry.npmjs.org/@types/body-parser/-/body-parser-1.19.6.tgz",
      "integrity": "sha512-HLFeCYgz89uk22N5Qg3dvGvsv46B8GLvKKo1zKG4NybA8U2DiEO3w9lqGg29t/tfLRJpJ6iQxnVw4OnB7MoM9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/connect": "*",
        "@types/node": "*"
      }

===== ./package.json =====
{
  "name": "advanced-banking-system",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "ts-node-dev --respawn --transpile-only src/server.ts",
    "build": "tsc",
    "start": "node dist/server.js",
    "prisma:init": "prisma init --datasource-provider postgresql",
    "prisma:migrate": "prisma migrate dev",
    "prisma:generate": "prisma generate"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "@prisma/client": "^6.15.0",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.2.1",
    "helmet": "^8.1.0",
    "morgan": "^1.10.1",
    "zod": "^4.1.13"
  },
  "devDependencies": {
    "@types/cors": "^2.8.19",
    "@types/express": "^5.0.6",
    "@types/morgan": "^1.9.10",
    "@types/node": "^24.10.2",
    "prisma": "^6.15.0",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.9.3"
  }
}

===== ./prisma/migrations/20251211111452_init_schema/migration.sql =====
-- CreateEnum
CREATE TYPE "Role" AS ENUM ('CUSTOMER', 'TELLER', 'MANAGER', 'ADMIN');

-- CreateEnum
CREATE TYPE "AccountType" AS ENUM ('SAVINGS', 'CHECKING', 'LOAN', 'INVESTMENT');

-- CreateEnum
CREATE TYPE "AccountState" AS ENUM ('ACTIVE', 'FROZEN', 'SUSPENDED', 'CLOSED');

-- CreateEnum
CREATE TYPE "TransactionType" AS ENUM ('DEPOSIT', 'WITHDRAWAL', 'TRANSFER');

-- CreateEnum
CREATE TYPE "TransactionStatus" AS ENUM ('PENDING', 'COMPLETED', 'FAILED');

-- CreateEnum
CREATE TYPE "TicketStatus" AS ENUM ('OPEN', 'IN_PROGRESS', 'CLOSED');

-- CreateEnum
CREATE TYPE "NotificationChannel" AS ENUM ('EMAIL', 'SMS', 'IN_APP');

-- CreateEnum
CREATE TYPE "NotificationStatus" AS ENUM ('PENDING', 'SENT', 'FAILED');

-- CreateEnum
CREATE TYPE "Frequency" AS ENUM ('DAILY', 'WEEKLY', 'MONTHLY');

-- CreateTable
CREATE TABLE "User" (
    "id" SERIAL NOT NULL,
    "username" TEXT NOT NULL,
    "passwordHash" TEXT NOT NULL,
    "email" TEXT,
    "phone" TEXT,
    "role" "Role" NOT NULL DEFAULT 'CUSTOMER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "User_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "Account" (
    "id" SERIAL NOT NULL,
    "userId" INTEGER NOT NULL,
    "accountType" "AccountType" NOT NULL,
    "balance" DECIMAL(65,30) NOT NULL DEFAULT 0.0,
    "state" "AccountState" NOT NULL DEFAULT 'ACTIVE',
    "parentAccountId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "Account_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "Transaction" (
    "id" SERIAL NOT NULL,
    "fromAccountId" INTEGER,
    "toAccountId" INTEGER,
    "amount" DECIMAL(65,30) NOT NULL,
    "type" "TransactionType" NOT NULL,
    "status" "TransactionStatus" NOT NULL DEFAULT 'PENDING',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "approvedById" INTEGER,

    CONSTRAINT "Transaction_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "ScheduledTransaction" (
    "id" SERIAL NOT NULL,
    "fromAccountId" INTEGER,
    "toAccountId" INTEGER,
    "amount" DECIMAL(65,30) NOT NULL,
    "type" "TransactionType" NOT NULL,
    "frequency" "Frequency" NOT NULL,
    "nextRunAt" TIMESTAMP(3) NOT NULL,
    "isActive" BOOLEAN NOT NULL DEFAULT true,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "ScheduledTransaction_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "Ticket" (
    "id" SERIAL NOT NULL,
    "userId" INTEGER NOT NULL,
    "subject" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "status" "TicketStatus" NOT NULL DEFAULT 'OPEN',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "Ticket_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "Notification" (
    "id" SERIAL NOT NULL,
    "userId" INTEGER NOT NULL,
    "relatedAccountId" INTEGER,
    "relatedTransactionId" INTEGER,
    "channel" "NotificationChannel" NOT NULL,
    "message" TEXT NOT NULL,
    "status" "NotificationStatus" NOT NULL DEFAULT 'PENDING',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "sentAt" TIMESTAMP(3),

    CONSTRAINT "Notification_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "EventLog" (
    "id" SERIAL NOT NULL,
    "userId" INTEGER,
    "accountId" INTEGER,
    "transactionId" INTEGER,
    "eventType" TEXT NOT NULL,
    "details" JSONB,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "EventLog_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "User_username_key" ON "User"("username");

-- CreateIndex
CREATE UNIQUE INDEX "User_email_key" ON "User"("email");

-- AddForeignKey
ALTER TABLE "Account" ADD CONSTRAINT "Account_userId_fkey" FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Account" ADD CONSTRAINT "Account_parentAccountId_fkey" FOREIGN KEY ("parentAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Transaction" ADD CONSTRAINT "Transaction_fromAccountId_fkey" FOREIGN KEY ("fromAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Transaction" ADD CONSTRAINT "Transaction_toAccountId_fkey" FOREIGN KEY ("toAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Transaction" ADD CONSTRAINT "Transaction_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "ScheduledTransaction" ADD CONSTRAINT "ScheduledTransaction_fromAccountId_fkey" FOREIGN KEY ("fromAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "ScheduledTransaction" ADD CONSTRAINT "ScheduledTransaction_toAccountId_fkey" FOREIGN KEY ("toAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Ticket" ADD CONSTRAINT "Ticket_userId_fkey" FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Notification" ADD CONSTRAINT "Notification_userId_fkey" FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Notification" ADD CONSTRAINT "Notification_relatedAccountId_fkey" FOREIGN KEY ("relatedAccountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Notification" ADD CONSTRAINT "Notification_relatedTransactionId_fkey" FOREIGN KEY ("relatedTransactionId") REFERENCES "Transaction"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "EventLog" ADD CONSTRAINT "EventLog_userId_fkey" FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "EventLog" ADD CONSTRAINT "EventLog_accountId_fkey" FOREIGN KEY ("accountId") REFERENCES "Account"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "EventLog" ADD CONSTRAINT "EventLog_transactionId_fkey" FOREIGN KEY ("transactionId") REFERENCES "Transaction"("id") ON DELETE SET NULL ON UPDATE CASCADE;

===== ./prisma/migrations/migration_lock.toml =====
# Please do not edit this file manually
# It should be added in your version-control system (e.g., Git)
provider = "postgresql"

===== ./prisma/schema.prisma =====
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id           Int           @id @default(autoincrement())
  username     String        @unique
  passwordHash String
  email        String?       @unique
  phone        String?
  role         Role          @default(CUSTOMER)
  createdAt    DateTime      @default(now())

  accounts     Account[]
  tickets      Ticket[]
  notifications Notification[]
  events       EventLog[]
  approvedTransactions Transaction[] @relation("ApprovedBy")

}

model Account {
  id              Int          @id @default(autoincrement())
  userId          Int
  user            User         @relation(fields: [userId], references: [id])
  accountType     AccountType
  balance         Decimal      @default(0.0)
  state           AccountState @default(ACTIVE)
  parentAccountId Int?         
  parentAccount   Account?     @relation("AccountHierarchy", fields: [parentAccountId], references: [id])
  subAccounts     Account[]    @relation("AccountHierarchy")
  createdAt       DateTime     @default(now())

  transactionsFrom Transaction[] @relation("FromAccount")
  transactionsTo   Transaction[] @relation("ToAccount")
  scheduledFrom    ScheduledTransaction[] @relation("ScheduledFrom")
  scheduledTo      ScheduledTransaction[] @relation("ScheduledTo")
  notifications    Notification[]
  events           EventLog[]
}

model Transaction {
  id            Int              @id @default(autoincrement())
  fromAccountId Int?             
  fromAccount   Account?         @relation("FromAccount", fields: [fromAccountId], references: [id])
  toAccountId   Int?
  toAccount     Account?         @relation("ToAccount", fields: [toAccountId], references: [id])
  amount        Decimal
  type          TransactionType
  status        TransactionStatus @default(PENDING)
  createdAt     DateTime          @default(now())
  approvedById  Int?               // Manager / Teller
  approvedBy    User?             @relation("ApprovedBy", fields: [approvedById], references: [id])

  notifications Notification[]
  events        EventLog[]
}

model ScheduledTransaction {
  id            Int       @id @default(autoincrement())
  fromAccountId Int?
  fromAccount   Account?  @relation("ScheduledFrom", fields: [fromAccountId], references: [id])
  toAccountId   Int?
  toAccount     Account?  @relation("ScheduledTo", fields: [toAccountId], references: [id])
  amount        Decimal
  type          TransactionType
  frequency     Frequency
  nextRunAt     DateTime
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
}

model Ticket {
  id          Int          @id @default(autoincrement())
  userId      Int
  user        User         @relation(fields: [userId], references: [id])
  subject     String
  description String
  status      TicketStatus @default(OPEN)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Notification {
  id                 Int           @id @default(autoincrement())
  userId             Int
  user               User          @relation(fields: [userId], references: [id])
  relatedAccountId   Int?
  relatedAccount     Account?      @relation(fields: [relatedAccountId], references: [id])
  relatedTransactionId Int?
  relatedTransaction Transaction? @relation(fields: [relatedTransactionId], references: [id])
  channel            NotificationChannel
  message            String
  status             NotificationStatus @default(PENDING)
  createdAt          DateTime      @default(now())
  sentAt             DateTime?
}

model EventLog {
  id             Int        @id @default(autoincrement())
  userId         Int?
  user           User?      @relation(fields: [userId], references: [id])
  accountId      Int?
  account        Account?   @relation(fields: [accountId], references: [id])
  transactionId  Int?
  transaction    Transaction? @relation(fields: [transactionId], references: [id])
  eventType      String
  details        Json?
  createdAt      DateTime   @default(now())
}

enum Role {
  CUSTOMER
  TELLER
  MANAGER
  ADMIN
}

enum AccountType {
  SAVINGS
  CHECKING
  LOAN
  INVESTMENT
}

enum AccountState {
  ACTIVE
  FROZEN
  SUSPENDED
  CLOSED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  CLOSED
}

enum NotificationChannel {
  EMAIL
  SMS
  IN_APP
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}

enum Frequency {
  DAILY
  WEEKLY
  MONTHLY
}

===== ./project_dump.txt =====

===== ./.env =====
DATABASE_URL="postgresql://postgres:1234@localhost:5432/advanced_banking?schema=public"
PORT=3000
NODE_ENV=development

===== ./.gitignore =====
node_modules
# Keep environment variables out of version control
.env

/src/generated/prisma

===== ./package-lock.json =====
{
  "name": "advanced-banking-system",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "advanced-banking-system",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "@prisma/client": "^6.15.0",
        "cors": "^2.8.5",
        "dotenv": "^17.2.3",
        "express": "^5.2.1",
        "helmet": "^8.1.0",
        "morgan": "^1.10.1",
        "zod": "^4.1.13"
      },
      "devDependencies": {
        "@types/cors": "^2.8.19",
        "@types/express": "^5.0.6",
        "@types/morgan": "^1.9.10",
        "@types/node": "^24.10.2",
        "prisma": "^6.15.0",
        "ts-node-dev": "^2.0.0",
        "typescript": "^5.9.3"
      }
    },
    "node_modules/@cspotcode/source-map-support": {
      "version": "0.8.1",
      "resolved": "https://registry.npmjs.org/@cspotcode/source-map-support/-/source-map-support-0.8.1.tgz",
      "integrity": "sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/trace-mapping": "0.3.9"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.9.tgz",
      "integrity": "sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.0.3",
        "@jridgewell/sourcemap-codec": "^1.4.10"
      }
    },
    "node_modules/@prisma/client": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/client/-/client-6.15.0.tgz",
      "integrity": "sha512-wR2LXUbOH4cL/WToatI/Y2c7uzni76oNFND7+23ypLllBmIS8e3ZHhO+nud9iXSXKFt1SoM3fTZvHawg63emZw==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "peerDependencies": {
        "prisma": "*",
        "typescript": ">=5.1.0"
      },
      "peerDependenciesMeta": {
        "prisma": {
          "optional": true
        },
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/@prisma/config": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/config/-/config-6.15.0.tgz",
      "integrity": "sha512-KMEoec9b2u6zX0EbSEx/dRpx1oNLjqJEBZYyK0S3TTIbZ7GEGoVyGyFRk4C72+A38cuPLbfQGQvgOD+gBErKlA==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "c12": "3.1.0",
        "deepmerge-ts": "7.1.5",
        "effect": "3.16.12",
        "empathic": "2.0.0"
      }
    },
    "node_modules/@prisma/debug": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/debug/-/debug-6.15.0.tgz",
      "integrity": "sha512-y7cSeLuQmyt+A3hstAs6tsuAiVXSnw9T55ra77z0nbNkA8Lcq9rNcQg6PI00by/+WnE/aMRJ/W7sZWn2cgIy1g==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/engines": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/engines/-/engines-6.15.0.tgz",
      "integrity": "sha512-opITiR5ddFJ1N2iqa7mkRlohCZqVSsHhRcc29QXeldMljOf4FSellLT0J5goVb64EzRTKcIDeIsJBgmilNcKxA==",
      "devOptional": true,
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0",
        "@prisma/engines-version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
        "@prisma/fetch-engine": "6.15.0",
        "@prisma/get-platform": "6.15.0"
      }
    },
    "node_modules/@prisma/engines-version": {
      "version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
      "resolved": "https://registry.npmjs.org/@prisma/engines-version/-/engines-version-6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb.tgz",
      "integrity": "sha512-a/46aK5j6L3ePwilZYEgYDPrhBQ/n4gYjLxT5YncUTJJNRnTCVjPF86QdzUOLRdYjCLfhtZp9aum90W0J+trrg==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/fetch-engine": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/fetch-engine/-/fetch-engine-6.15.0.tgz",
      "integrity": "sha512-xcT5f6b+OWBq6vTUnRCc7qL+Im570CtwvgSj+0MTSGA1o9UDSKZ/WANvwtiRXdbYWECpyC3CukoG3A04VTAPHw==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0",
        "@prisma/engines-version": "6.15.0-5.85179d7826409ee107a6ba334b5e305ae3fba9fb",
        "@prisma/get-platform": "6.15.0"
      }
    },
    "node_modules/@prisma/get-platform": {
      "version": "6.15.0",
      "resolved": "https://registry.npmjs.org/@prisma/get-platform/-/get-platform-6.15.0.tgz",
      "integrity": "sha512-Jbb+Xbxyp05NSR1x2epabetHiXvpO8tdN2YNoWoA/ZsbYyxxu/CO/ROBauIFuMXs3Ti+W7N7SJtWsHGaWte9Rg==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.15.0"
      }
    },
    "node_modules/@standard-schema/spec": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@standard-schema/spec/-/spec-1.0.0.tgz",
      "integrity": "sha512-m2bOd0f2RT9k8QJx1JN85cZYyH1RqFBdlwtkSlf4tBDYLCiiZnv1fIIwacK6cqwXavOydf0NPToMQgpKq+dVlA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node10": {
      "version": "1.0.12",
      "resolved": "https://registry.npmjs.org/@tsconfig/node10/-/node10-1.0.12.tgz",
      "integrity": "sha512-UCYBaeFvM11aU2y3YPZ//O5Rhj+xKyzy7mvcIoAjASbigy8mHMryP5cK7dgjlz2hWxh1g5pLw084E0a/wlUSFQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node12": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/@tsconfig/node12/-/node12-1.0.11.tgz",
      "integrity": "sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node14": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/@tsconfig/node14/-/node14-1.0.3.tgz",
      "integrity": "sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node16": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/@tsconfig/node16/-/node16-1.0.4.tgz",

===== ./src/api/controllers/account.controller.ts =====

===== ./src/api/middleware/errorHandler.ts =====
import { Request, Response, NextFunction } from 'express';

export function errorHandler(
  err: any,
  req: Request,
  res: Response,
  next: NextFunction
) {
  console.error('âŒ Error:', err);

  const status = err.status || 500;
  const message = err.message || 'Internal Server Error';

  res.status(status).json({
    success: false,
    message
  });
}

===== ./src/api/routes/account.routes.ts =====

===== ./src/api/routes/index.ts =====
import { Router } from 'express';

const router = Router();

router.get('/health', (req, res) => {
  res.json({ status: 'ok' });
});

export default router;

===== ./src/app.ts =====
import express from 'express';
import dotenv from 'dotenv';
import helmet from 'helmet';
import cors from 'cors';
import morgan from 'morgan';
import routes from './api/routes';
import { errorHandler } from './api/middleware/errorHandler';

dotenv.config();

const app = express();

app.use(helmet());
app.use(cors());
app.use(morgan('dev'));
app.use(express.json());

app.use('/api', routes);

app.use(errorHandler);

export default app;

===== ./src/domain/accounts/AccountFactory.ts =====
import { AccountType } from './types';
import { AccountLeaf } from './composite/AccountLeaf';
import { SavingsAccount } from './composite/SavingsAccount';
import { CheckingAccount } from './composite/CheckingAccount';
import { LoanAccount } from './composite/LoanAccount';
import { InvestmentAccount } from './composite/InvestmentAccount';

export class AccountFactory {
  static create(params: {
    id: string;
    name: string;
    type: AccountType;
    initialBalance?: number;
    overdraftLimit?: number; 
  }): AccountLeaf {
    const bal = params.initialBalance ?? 0;

    switch (params.type) {
      case 'SAVINGS':
        return new SavingsAccount(params.id, params.name, bal);

      case 'CHECKING':
        return new CheckingAccount(params.id, params.name, bal, params.overdraftLimit ?? 0);

      case 'LOAN':
        return new LoanAccount(params.id, params.name, bal);

      case 'INVESTMENT':
        return new InvestmentAccount(params.id, params.name, bal);

      default:
        throw new Error(`Unsupported account type: ${params.type}`);
    }
  }
}

===== ./src/domain/accounts/composite/AccountComponent.ts =====
export interface AccountComponent {
  getId(): string;
  getName(): string;
  getBalance(): number;

  rename(newName: string): void;

  deposit(amount: number): void;
  withdraw(amount: number): void;

  add(child: AccountComponent): void;
  remove(childId: string): void;
  getChildren(): AccountComponent[];
}

===== ./src/domain/accounts/composite/AccountGroup.ts =====
import { AccountComponent } from './AccountComponent';

export class AccountGroup implements AccountComponent {
  private id: string;
  private name: string;
  private children: AccountComponent[] = [];

  constructor(id: string, name: string) {
    this.id = id;
    this.name = name;
  }
rename(newName: string): void {
  if (!newName.trim()) throw new Error('Group name cannot be empty');
  this.name = newName;
}

 deposit(): void {
    throw new Error('Cannot deposit directly into an account group');
  }

  withdraw(): void {
    throw new Error('Cannot withdraw directly from an account group');
  }

  getId() { return this.id; }
  getName() { return this.name; }

  add(child: AccountComponent): void {
    this.children.push(child);
  }

  remove(childId: string): void {
    this.children = this.children.filter(c => c.getId() !== childId);
  }

  getChildren(): AccountComponent[] {
    return [...this.children];
  }

  getBalance(): number {
    return this.children.reduce((sum, c) => sum + c.getBalance(), 0);
  }
}

===== ./src/domain/accounts/composite/AccountLeaf.ts =====
// src/domain/accounts/composite/AccountLeaf.ts
import { AccountComponent } from './AccountComponent';
import { AccountState } from '../state/AccountState';
import { ActiveState } from '../state/ActiveState';
import { InterestStrategy, InterestContext } from '../interest_strategy/InterestStrategy';


export abstract class AccountLeaf implements AccountComponent {
  protected id: string;
  protected name: string;
  protected balance: number;
  protected state: AccountState;

  constructor(id: string, name: string, initialBalance = 0) {
    this.id = id;
    this.name = name;
    this.balance = initialBalance;
    this.state = new ActiveState();
  }
  
 rename(newName: string): void {
  if (!newName.trim()) {
    throw new Error('Account name cannot be empty');
  }
  this.name = newName;
}

  getId() { return this.id; }
  getName() { return this.name; }
  getBalance() { return this.balance; }
  getState() { return this.state.name; }

  freeze() { this.state.freeze(this); }
  suspend() { this.state.suspend(this); }
  activate() { this.state.activate(this); }
  close() { this.state.close(this); }

  deposit(amount: number) {
    if (amount <= 0) throw new Error('Amount must be positive');
    this.state.deposit(this, amount);
  }

  withdraw(amount: number) {
    if (amount <= 0) throw new Error('Amount must be positive');
    this.state.withdraw(this, amount);
  }

  setState(s: AccountState) { this.state = s; }

  increaseBalance(a: number) { this.balance += a; }

  decreaseBalance(a: number) {
    this.assertCanWithdraw(a); 
    this.balance -= a;

  }

  protected abstract assertCanWithdraw(amount: number): void;

  calculateInterest(interestStrategy: InterestStrategy,context?: InterestContext): number {
  if (!interestStrategy) return 0;
  return interestStrategy.calculate(this.balance, context);
  }

  add(): void {
    throw new Error('Leaf account cannot have children');
  }
  remove(): void {
    throw new Error('Leaf account cannot have children');
  }
  getChildren(): AccountComponent[] {
    return [];
  }
}

===== ./src/domain/accounts/composite/CheckingAccount.ts =====
import { AccountLeaf } from './AccountLeaf';

export class CheckingAccount extends AccountLeaf {
  private overdraftLimit: number;

  constructor(id: string, name: string, initialBalance = 0, overdraftLimit = 0) {
    super(id, name, initialBalance);
    this.overdraftLimit = overdraftLimit;
  }

  setOverdraftLimit(limit: number) {
    if (limit < 0) throw new Error('Overdraft limit must be >= 0');
    this.overdraftLimit = limit;
  }

  getOverdraftLimit() {
    return this.overdraftLimit;
  }

  protected assertCanWithdraw(amount: number): void {
    if (this.balance - amount < -this.overdraftLimit) {
      throw new Error('Overdraft limit exceeded (checking)');
    }
  }
}

===== ./src/domain/accounts/composite/InvestmentAccount.ts =====
import { AccountLeaf } from './AccountLeaf';

export class InvestmentAccount extends AccountLeaf {
  protected assertCanWithdraw(amount: number): void {
    if (amount > this.balance) {
      throw new Error('Insufficient funds (investment)');
    }
  }
}

===== ./src/domain/accounts/composite/LoanAccount.ts =====
import { AccountLeaf } from './AccountLeaf';

export class LoanAccount extends AccountLeaf {
  protected assertCanWithdraw(amount: number): void {
    throw new Error('Withdrawals are not allowed from a loan account');
  }
  deposit(amount: number) {
    this.deposit(amount);
  }
}

===== ./src/domain/accounts/composite/SavingsAccount.ts =====
import { AccountLeaf } from './AccountLeaf';

export class SavingsAccount extends AccountLeaf {
  protected assertCanWithdraw(amount: number): void {
    if (amount > this.balance) {
      throw new Error('Insufficient funds (savings)');
    }
  }
}

===== ./src/domain/accounts/decorator/AccountDecorator.ts =====
import { AccountComponent } from "../composite/AccountComponent";


export abstract class AccountDecorator implements AccountComponent {
  constructor(protected wrap: AccountComponent) {}

  getId() { return this.wrap.getId(); }
  getName() { return this.wrap.getName(); }
  getBalance() { return this.wrap.getBalance(); }

  deposit(amount: number) { return this.wrap.deposit(amount); }
  withdraw(amount: number) { return this.wrap.withdraw(amount); }

  add(child: AccountComponent) { return this.wrap.add(child); }
  remove(childId: string) { return this.wrap.remove(childId); }
  getChildren() { return this.wrap.getChildren(); }
}

===== ./src/domain/accounts/decorator/InsuranceDecorator.ts =====
// src/domain/accounts/decorator/InsuranceDecorator.ts

import { AccountDecorator } from "./AccountDecorator";

export class InsuranceDecorator extends AccountDecorator {
  constructor(wrap: any, private feePerWithdraw = 2) {
    super(wrap);
  }

  withdraw(amount: number) {
    // Ù†Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº
    super.withdraw(amount);

    // ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ù†Ø³Ø­Ø¨ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ£Ù…ÙŠÙ†
    super.withdraw(this.feePerWithdraw);
  }
}

===== ./src/domain/accounts/decorator/OverdraftDecorator.ts =====
// src/domain/accounts/decorator/OverdraftDecorator.ts
import { AccountDecorator } from './AccountDecorator';
import { CheckingAccount } from '../composite/CheckingAccount';

export class OverdraftDecorator extends AccountDecorator {
  constructor(wrap: CheckingAccount, extraLimit: number) {
    super(wrap);

    if (extraLimit <= 0) throw new Error('extraLimit must be positive');

    wrap.setOverdraftLimit(wrap.getOverdraftLimit() + extraLimit);
  }
}

===== ./src/domain/accounts/decorator/PremiumServiceDecorator.ts =====
import { AccountDecorator } from './AccountDecorator';

export class PremiumServiceDecorator extends AccountDecorator {
  constructor(wrap: any, private cashbackRate = 0.005) {
    super(wrap);
  }

  deposit(amount: number) {
    const cashback = amount * this.cashbackRate;
    return super.deposit(amount + cashback);
  }
}

===== ./src/domain/accounts/interest_strategy/FixedRateInterest.ts =====
import { InterestStrategy, InterestContext } from './InterestStrategy';

export class FixedRateInterest implements InterestStrategy {
  constructor(private annualRate: number) {}

  calculate(balance: number, context?: InterestContext): number {
    return Math.max(balance, 0) * this.annualRate;
  }
}

===== ./src/domain/accounts/interest_strategy/InterestStrategy.ts =====
export interface InterestStrategy {
  calculate(balance: number, context?: InterestContext): number;
}

export interface InterestContext {
  marketRate?: number;  // ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³ÙˆÙ‚
  isPremium?: boolean;  // Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ²
}

===== ./src/domain/accounts/interest_strategy/MarketBasedInterest.ts =====
import { InterestStrategy, InterestContext } from './InterestStrategy';

export class MarketBasedInterest implements InterestStrategy {
  constructor(private baseRate: number, private premiumBonus = 0.01) {}

  calculate(balance: number, context?: InterestContext): number {
    const b = Math.max(balance, 0);
    const market = context?.marketRate ?? 0;
    const premium = context?.isPremium ? this.premiumBonus : 0;
    return b * (this.baseRate + market + premium);
  }
}

===== ./src/domain/accounts/interest_strategy/TieredInterest.ts =====
import { InterestStrategy, InterestContext } from './InterestStrategy';

export class TieredInterest implements InterestStrategy {
  constructor(
    private tier1Limit: number,
    private tier1Rate: number,
    private tier2Rate: number
  ) {}

  calculate(balance: number, context?: InterestContext): number {
    const b = Math.max(balance, 0);
    const tier1 = Math.min(b, this.tier1Limit);
    const tier2 = Math.max(b - this.tier1Limit, 0);
    return tier1 * this.tier1Rate + tier2 * this.tier2Rate;
  }
}

===== ./src/domain/accounts/state/AccountState.ts =====
import type { AccountLeaf } from '../composite/AccountLeaf';

export interface AccountState {
  name: 'ACTIVE' | 'FROZEN' | 'SUSPENDED' | 'CLOSED';

  deposit(account: AccountLeaf, amount: number): void;
  withdraw(account: AccountLeaf, amount: number): void;

  freeze(account: AccountLeaf): void;
  suspend(account: AccountLeaf): void;
  activate(account: AccountLeaf): void;
  close(account: AccountLeaf): void;
}

===== ./src/domain/accounts/state/ActiveState.ts =====
import type { AccountLeaf } from '../composite/AccountLeaf';
import { AccountState } from './AccountState';
import { FrozenState } from './FrozenState';
import { SuspendedState } from './SuspendedState';
import { ClosedState } from './ClosedState';

export class ActiveState implements AccountState {
  name = 'ACTIVE' as const;

  deposit(account: AccountLeaf, amount: number): void {
    account.increaseBalance(amount);
  }

  withdraw(account: AccountLeaf, amount: number): void {
    account.decreaseBalance(amount); 
  }

  freeze(account: AccountLeaf): void {
    account.setState(new FrozenState());
  }

  suspend(account: AccountLeaf): void {
    account.setState(new SuspendedState());
  }

  activate(account: AccountLeaf): void {
    // already active
  }

  close(account: AccountLeaf): void {
    account.setState(new ClosedState());
  }
}

===== ./src/domain/accounts/state/ClosedState.ts =====

import { AccountState } from './AccountState';

export class ClosedState implements AccountState {
  name = 'CLOSED' as const;

  deposit(): void {
    throw new Error('Account is closed');
  }

  withdraw(): void {
    throw new Error('Account is closed');
  }

  freeze(): void {
    throw new Error('Account is closed');
  }

  suspend(): void {
    throw new Error('Account is closed');
  }

  activate(): void {
    throw new Error('Account is closed');
  }

  close(): void {
    // already closed
  }
}

===== ./src/domain/accounts/state/FrozenState.ts =====
import type { AccountLeaf } from '../composite/AccountLeaf';
import { AccountState } from './AccountState';
import { ActiveState } from './ActiveState';
import { SuspendedState } from './SuspendedState';
import { ClosedState } from './ClosedState';

export class FrozenState implements AccountState {
  name = 'FROZEN' as const;

  deposit(account: AccountLeaf, amount: number): void {
    
    account.increaseBalance(amount);
  }

  withdraw(account: AccountLeaf, amount: number): void {
    throw new Error('Account is frozen: withdrawals are not allowed');
  }

  freeze(account: AccountLeaf): void {
    // already frozen
  }

  suspend(account: AccountLeaf): void {
    account.setState(new SuspendedState());
  }

  activate(account: AccountLeaf): void {
    account.setState(new ActiveState());
  }

  close(account: AccountLeaf): void {
    account.setState(new ClosedState());
  }
}

===== ./src/domain/accounts/state/SuspendedState.ts =====
// src/domain/accounts/state/SuspendedState.ts
import type { AccountLeaf } from '../composite/AccountLeaf';
import { AccountState } from './AccountState';
import { ActiveState } from './ActiveState';
import { ClosedState } from './ClosedState';

export class SuspendedState implements AccountState {
  name = 'SUSPENDED' as const;

  deposit(account: AccountLeaf, amount: number): void {
    throw new Error('Account is suspended: transactions are not allowed');
  }

  withdraw(account: AccountLeaf, amount: number): void {
    throw new Error('Account is suspended: transactions are not allowed');
  }

  freeze(account: AccountLeaf): void {
    throw new Error('Account is suspended: cannot freeze');
  }

  suspend(account: AccountLeaf): void {
    // already suspended
  }

  activate(account: AccountLeaf): void {
    account.setState(new ActiveState());
  }

  close(account: AccountLeaf): void {
    account.setState(new ClosedState());
  }
}

===== ./src/domain/accounts/types.ts =====
export type AccountType = 'SAVINGS' | 'CHECKING' | 'LOAN' | 'INVESTMENT';

===== ./src/domain/transactions/t.ts =====
export interface TransactionStrategy {
  supports(type: string): boolean;

  // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø¨Ø¯ÙˆÙ† validation chain Ø­Ø§Ù„ÙŠØ§Ù‹â€”Ø±Ø­ Ù†Ø¶ÙŠÙÙ‡Ø§ Ø¨Ø¹Ø¯ÙŠÙ†)
  execute(tx: Transaction, deps: TransactionDeps): Promise<TransactionResult>;
}

===== ./src/infrastructure/prisma/client.ts =====
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export default prisma;

===== ./src/server.ts =====
import app from './app';

const PORT = process.env.PORT || 3000;

const server = app.listen(PORT, () => {
  console.log(`ðŸš€ Server running on port ${PORT}`);
});

process.on('SIGINT', () => {
  console.log('ðŸ”» Shutting down...');
  server.close(() => process.exit(0));
});

===== ./tsconfig.json =====
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "rootDir": "./src",
    "outDir": "./dist",
    "strict": true,
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "skipLibCheck": true
  },
  "include": ["src"]
}
